<html><head><title>Internals</title><style type="text/css">ol{margin:0;padding:0}.c13{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c8{color:inherit;text-decoration:inherit}.c7{text-indent:36pt;margin-left:36pt}.c1{color:#1155cc;text-decoration:underline}.c3{font-style:italic}.c12{text-indent:36pt}.c6{font-weight:bold}.c5{height:11pt}.c2{font-family:"Courier New"}.c11{font-size:36pt}.c4{margin-left:72pt}.c10{margin-left:36pt}.c9{text-decoration:underline}.c0{direction:ltr}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c13"><p class="c0"><span class="c6 c11">Web F. Site Internals</span></p><p class="c5 c0"><span class="c6 c9"></span></p><p class="c0"><span>The Web F. Site is built using Django, Javascript/JQuery, and CSS-styled HTML.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6 c9">Workflow</span><span class="c6">:</span></p><p class="c0"><span class="c6">Virtual Environment</span></p><p class="c0"><span>Work on the Web F. Site was developed in a virtual environment that standardized tools (python, django, database, git, and deployment tools) across all development machines. &nbsp;Our environment takes a small amount of time to set up, but quickly pays dividends in time saved avoiding version conflicts. &nbsp;It is strongly recommended that any developers working on the Web F. Site install this virtual environment and use to do all work on the site. &nbsp;The environment may be installed as follows:</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>1) Install pip and virtualenv:</span></p><p class="c0"><span>&nbsp; &nbsp;(</span><span class="c1"><a class="c8" href="http://docs.python-guide.org/en/latest/starting/install/osx/#install-osx">http://docs.python-guide.org/en/latest/starting/install/osx/#install-osx</a></span><span>)</span></p><p class="c0"><span>2) Set up a virtual environment:</span></p><p class="c0"><span>&nbsp; &nbsp;</span><span class="c2">mkdir ~/.virtualenvs</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;virtualenv ~/.virtualenvs/future</span></p><p class="c0"><span>&nbsp; &nbsp;(don&#39;t start the virtual enviroment yet)</span></p><p class="c0"><span>3) Install foreman</span></p><p class="c0"><span>&nbsp; &nbsp;3a) install rvm with your package manager.</span></p><p class="c0"><span>&nbsp; &nbsp;3b) reload your shell</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; source ~/.bashrc</span></p><p class="c0"><span>&nbsp; &nbsp;3c) Install foreman</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; </span><span class="c2">gem install foreman</span></p><p class="c0"><span>3) Clone the Git repo:</span></p><p class="c0"><span>&nbsp; &nbsp;3a) set up git:</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; </span><span class="c1"><a class="c8" href="http://help.github.com/mac-set-up-git/">http://help.github.com/mac-set-up-git/</a></span></p><p class="c0"><span>&nbsp; &nbsp;3b) Clone the repo:</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; </span><span class="c2">mkdir [dir_for_project]</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;git clone https://github.com/jsnydes/future</span></p><p class="c0"><span>4) Enter virtual environment, and install dependencies:</span></p><p class="c0"><span>&nbsp; &nbsp;</span><span class="c2">source ~/.virtualenvs/future/bin/activate</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; (you will see &#39;(future)&#39; prepended to your prompt)</span></p><p class="c0"><span>&nbsp; &nbsp;</span><span class="c2">cd [dir_for_project]</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;pip install -r requirements.txt</span></p><p class="c0"><span>5) test that everything worked...</span></p><p class="c0"><span>&nbsp; </span><span class="c2">&nbsp;foreman start</span></p><p class="c0"><span>&nbsp; &nbsp;(you should see no error messages)</span></p><p class="c0"><span>&nbsp; &nbsp;(go to localhost:5000 in browser to see site.)</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>Whenever you want to work in the environment again, execute: </span><span class="c2">source ~/.virtualenvs/future/bin/activate</span><span>. &nbsp;This command may be aliased on by adding the line </span><span class="c2">alias future=source ~/.virtualenvs/future/bin/activate&#39;</span><span>&nbsp;to your .bashrc file for easy access.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6">Framework:</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>Our site was built using Django as a framework. &nbsp;Django can be found at </span><span class="c1"><a class="c8" href="https://www.djangoproject.com/">https://www.djangoproject.com/</a></span><span>, and documentation for Django can be found at </span><span class="c1"><a class="c8" href="https://docs.djangoproject.com/en/1.4/">https://docs.djangoproject.com/en/1.4/</a></span><span>. &nbsp;Tutorials for learning Django are available at </span><span class="c1"><a class="c8" href="http://www.djangobook.com/">www.djangobook.com</a></span><span>.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>JQuery was used as a cross-platform javascript framework. &nbsp;JQuery may be found at </span><span class="c1"><a class="c8" href="http://jquery.com/">http://jquery.com/</a></span><span>, and documentation for JQuery may be found at </span><span class="c1"><a class="c8" href="http://docs.jquery.com/Main_Page">http://docs.jquery.com/Main_Page</a></span><span>.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6 c9">Site Structure:</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6">Models</span><span>:</span></p><p class="c0"><span>A list of the database models used in the Web F. Site is provided below:</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c2">User</span></p><p class="c0"><span class="c2">Tag</span></p><p class="c0"><span class="c2">Post</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp;UserPost</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp;MenuPost</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp;Comment</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>The User and Post models are the fundamental data structures underlying the site. &nbsp;Posts deal with communication, and are created when users submit them using text fields on the front end. &nbsp;</span><span class="c2">Post</span><span>&nbsp;is a meta class from containing fields common to all user-submitted posts. &nbsp;Of the three child classes to </span><span class="c2">Post, UserPost</span><span>&nbsp;is the most important and most commonly created. &nbsp;</span><span class="c2">Comment</span><span>&nbsp;is subordinate to </span><span class="c2">UserPost</span><span>, and comments are associated with UserPosts through a one-to-many relationship. &nbsp;</span><span class="c2">Tag </span><span>is also subordinate to </span><span class="c2">UserPost, </span><span>and tags are associated with UserPosts through a many-to-many relationship. UserPost contains a field which allows it to be marked as an announcement, which will cause it to show up with the user visits the Announcements page. &nbsp;UserPosts and all associated data models are accessed through the </span><span class="c2">home.html</span><span>&nbsp;template.</span></p><p class="c0 c12"><span class="c2">MenuPost</span><span>&nbsp;stands apart from the other Post types in the sense that Tags and Comments cannot be associated with them, and because menus are displayed in </span><span class="c2">menus.html</span><span>&nbsp;rather than </span><span class="c2">home.html</span><span>. &nbsp;Consequently, menus also do not show up in text search.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6">URLs:</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The file urls.py includes seperate URL&rsquo;s for the creation and deletion of each kind of post, as well as URL&rsquo;s for access to each of the main site pages found in the top bar. &nbsp;The user, search, and hashtag URL&rsquo;s are all variable. &nbsp;Search and hashtag include regular expression matching that is used to execute the intended searching or filtering functions. &nbsp;The user URL is the user&rsquo;s name, and links to that user&rsquo;s profile page.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6">Views:</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Views are separated into the social-feed based views (announcements, search, hashtags, and profiles), the Menu and Directory, and user authentication. &nbsp;The announcements, search, hashtag filter, and profile rendering functions all perform database queries using Django ORM code to store lists of posts in a context which is passed to </span><span class="c2">home.html.</span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6">Authentication Flow:</span></p><p class="c5 c0"><span class="c6"></span></p><p class="c0"><span>The Web F. Site uses a facebook OAuth based authentication workflow, as documented on the facebook website here: </span><span class="c1"><a class="c8" href="https://developers.facebook.com/docs/authentication/server-side/">https://developers.facebook.com/docs/authentication/server-side/</a></span><span>. All authentication except for the approval of the facebook app and the signup of new users are handled server-side. Authentication functions are located in </span><span class="c2">futureapp.views</span><span>. The bulk of the authentication is handled by the</span><span class="c2">&nbsp;fbauth</span><span>&nbsp;function, which submits authentication requests to facebook&rsquo;s servers and parses the response. &nbsp;In order to associate a new visitor to the site or a user whose session has expired with our database representation of their account, we use their facebook ID, a unique integer defined by facebook. FB friend relationships are updated at each login and stored in the database. </span></p><p class="c5 c0"><span></span></p><p class="c0"><span>New users are created in the </span><span class="c2">newuser </span><span>view. The administrator enters the new user&rsquo;s data into the HTML form at newuser.html and the </span><span class="c2">createuser</span><span>&nbsp;view parses the data and creates a new database record. The </span><span class="c2">createuser</span><span>&nbsp;view also sends an email to the new user&rsquo;s Princeton email address with an authentication link. When the user visits this link, the </span><span class="c2">signup </span><span>view checks the authentication code and notes in the user&rsquo;s session that they are ready for authentication. This view then redirects the user to the </span><span class="c2">fbauth</span><span>&nbsp;view, which based on the session data, associates this database record with the user&rsquo;s facebook ID, which is how we identify them. The signup process is now complete. All of the authentication functions contain extensive error checking to prevent unauthorized users from accessing the site.</span></p><p class="c5 c0"><span></span></p><p class="c5 c0"><span></span></p><p class="c0"><span class="c6">Frontend:</span></p><p class="c0"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>In the Django site organization, our frontend files and resources are stored in two main directories. First, our HTML files reside in the </span><span class="c2">templates</span><span>&nbsp;</span><span>folder. Second, our CSS, JS and image files reside in the </span><span class="c3">&nbsp;</span><span class="c2">static</span><span>&nbsp;folder.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We have 7 html files, which we will briefly outline below:</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">home.html </span><span>is the page which renders all views that use the social feed.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">nav.html </span><span>is the top navigation bar which is included in every HTML file, except for </span></p><p class="c7 c0"><span class="c2">Splash.html </span><span>and </span><span class="c2">Error.html.</span><span class="c3">&nbsp;</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">splash.html </span><span>is the landing page, which allows users to sign-up/log-in.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">error.html </span><span>&nbsp;is our default error page.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">newuser.html </span><span>is the page, only accessible to administrators, that allows for the </span></p><p class="c0 c7"><span>creation of new users</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">directory.html </span><span>&nbsp;displays the users of the site and allows users to facebook friend </span></p><p class="c7 c0"><span>other users that they are not currently friends with</span></p><p class="c0 c10"><span class="c2">menu.html </span><span>is only slightly different from </span><span class="c2">home.html</span><span>, but does not use the social feed </span></p><p class="c0 c4"><span>and displays only food information posted by Terrace&rsquo;s food chairs</span></p><p class="c5 c0"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We made use of three CSS files. </span><span class="c2">home.css</span><span class="c3">&nbsp;</span><span>provides the vast majority of style rules for the site. The other two CSS files were created for the sake of modularity. </span><span class="c2">splash.css </span><span>provides styling for </span><span class="c2">splash.html </span><span>and </span><span class="c2">error.html</span><span class="c3 c2">. </span><span>Lastly, </span><span class="c2">directory.css</span><span class="c3">&nbsp;</span><span>provides custom, additional styling for the display of user information in </span><span class="c2">directory.html</span><span class="c2 c3">.</span><span>&nbsp;Directory.html, splash.html and error.html all incorporate CSS from </span><span class="c2">home.html</span><span>, but have their own respective stylesheets because of their own particular demands.</span></p><p class="c0 c5"><span></span></p></body></html>